apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: fedpod-
spec:
  entrypoint: parallel-dag
  onExit: infer-dag
  arguments:
    parameters:
    - name: data_root
      value: "data_cc359ppmicmc256_dwnusa"
    - name: data_set
      value: ""
    - name: train-script
      value: "run_train1.sh"
    - name: agg-script
      value: "run_aggregation.sh"
    - name: infer-script
      value: "run_forward1.sh"
    - name: rounds
      value: "20"
    - name: initial-round
      value: "00"
    - name: initial-epoch
      value: "000"
    - name: job-prefix
      value: "undefined"
    - name: split_csv
      value: "undefined" # "cc359ppmi128/CC359PPMI_nj4r12v3.csv"
    - name: init_model
      value: "None"
    - name: input_channel_names
      value: "None"
    - name: agg-algo
      value: "fedpod"
    - name: inst_01_ratio_1
      value: "100"
    - name: inst_02_ratio_1
      value: "100"
    - name: inst_03_ratio_1
      value: "100"
    - name: inst_04_ratio_1
      value: "100"
    - name: inst_05_ratio_1
      value: "100"
    - name: inst_06_ratio_1
      value: "100"
    - name: inst_07_ratio_1
      value: "100"
    - name: inst_08_ratio_1
      value: "100"
    - name: inst_09_ratio_1
      value: "100"
    - name: inst_10_ratio_1
      value: "100"
    - name: inst_11_ratio_1
      value: "100"
    - name: inst_12_ratio_1
      value: "100"
    - name: inst_13_ratio_1
      value: "100"
    - name: inst_14_ratio_1
      value: "100"
    - name: inst_15_ratio_1
      value: "100"
    - name: inst_16_ratio_1
      value: "100"
    - name: inst_17_ratio_1
      value: "100"
    - name: inst_18_ratio_1
      value: "100"
    - name: inst_19_ratio_1
      value: "100"
    - name: inst_20_ratio_1
      value: "100"
    - name: inst_21_ratio_1
      value: "100"
    - name: inst_22_ratio_1
      value: "100"
    - name: inst_23_ratio_1
      value: "100"
    - name: inst_01_ratio_2
      value: "100"
    - name: inst_02_ratio_2
      value: "100"
    - name: inst_03_ratio_2
      value: "100"
    - name: inst_04_ratio_2
      value: "100"
    - name: inst_05_ratio_2
      value: "100"
    - name: inst_06_ratio_2
      value: "100"
    - name: inst_07_ratio_2
      value: "100"
    - name: inst_08_ratio_2
      value: "100"
    - name: inst_09_ratio_2
      value: "100"
    - name: inst_10_ratio_2
      value: "100"
    - name: inst_11_ratio_2
      value: "100"
    - name: inst_12_ratio_2
      value: "100"
    - name: inst_13_ratio_2
      value: "100"
    - name: inst_14_ratio_2
      value: "100"
    - name: inst_15_ratio_2
      value: "100"
    - name: inst_16_ratio_2
      value: "100"
    - name: inst_17_ratio_2
      value: "100"
    - name: inst_18_ratio_2
      value: "100"
    - name: inst_19_ratio_2
      value: "100"
    - name: inst_20_ratio_2
      value: "100"
    - name: inst_21_ratio_2
      value: "100"
    - name: inst_22_ratio_2
      value: "100"
    - name: inst_23_ratio_2
      value: "100"
    - name: inst_01_ratio_3
      value: "100"
    - name: inst_02_ratio_3
      value: "100"
    - name: inst_03_ratio_3
      value: "100"
    - name: inst_04_ratio_3
      value: "100"
    - name: inst_05_ratio_3
      value: "100"
    - name: inst_06_ratio_3
      value: "100"
    - name: inst_07_ratio_3
      value: "100"
    - name: inst_08_ratio_3
      value: "100"
    - name: inst_09_ratio_3
      value: "100"
    - name: inst_10_ratio_3
      value: "100"
    - name: inst_11_ratio_3
      value: "100"
    - name: inst_12_ratio_3
      value: "100"
    - name: inst_13_ratio_3
      value: "100"
    - name: inst_14_ratio_3
      value: "100"
    - name: inst_15_ratio_3
      value: "100"
    - name: inst_16_ratio_3
      value: "100"
    - name: inst_17_ratio_3
      value: "100"
    - name: inst_18_ratio_3
      value: "100"
    - name: inst_19_ratio_3
      value: "100"
    - name: inst_20_ratio_3
      value: "100"
    - name: inst_21_ratio_3
      value: "100"
    - name: inst_22_ratio_3
      value: "100"
    - name: inst_23_ratio_3
      value: "100"
  templates:
  - name: parallel-dag
    dag:
      tasks:
      # Round 0
      - name: train-00
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{workflow.parameters.initial-round}}"
          - name: epochs
            value: "000"
          - name: epoch
            value: "{{workflow.parameters.initial-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "{{workflow.parameters.init_model}}"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "10001", inst: "1", data_percentage: "{{workflow.parameters.inst_01_ratio_1}}"}
        # - { seed: "10002", inst: "2", data_percentage: "{{workflow.parameters.inst_02_ratio_1}}"}
        # - { seed: "10003", inst: "3", data_percentage: "{{workflow.parameters.inst_03_ratio_1}}"}
        # - { seed: "10004", inst: "4", data_percentage: "{{workflow.parameters.inst_04_ratio_1}}"}
        # - { seed: "10005", inst: "5", data_percentage: "{{workflow.parameters.inst_05_ratio_1}}"}
        # - { seed: "10006", inst: "6", data_percentage: "{{workflow.parameters.inst_06_ratio_1}}"}

      - name: agg-00
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{workflow.parameters.initial-round}}"
          - name: epochs
            value: "000"
          - name: epoch
            value: "{{workflow.parameters.initial-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-00]

      # Round 1
      - name: train-01
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-00.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-00.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-00.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-00.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "10101", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_1}}"}
        - { seed: "10102", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_1}}"}
        - { seed: "10103", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_1}}"}
        - { seed: "10104", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_1}}"}
        - { seed: "10105", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_1}}"}
        - { seed: "10106", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_1}}"}
        - { seed: "10107", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_1}}"}
        - { seed: "10108", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_1}}"}
        - { seed: "10109", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_1}}"}
        - { seed: "10110", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_1}}"}
        - { seed: "10111", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_1}}"}
        - { seed: "10112", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_1}}"}
        - { seed: "10113", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_1}}"}
        - { seed: "10114", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_1}}"}
        - { seed: "10115", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_1}}"}
        - { seed: "10116", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_1}}"}
        - { seed: "10117", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_1}}"}
        - { seed: "10118", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_1}}"}
        - { seed: "10119", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_1}}"}
        - { seed: "10120", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_1}}"}
        - { seed: "10121", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_1}}"}
        - { seed: "10122", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_1}}"}
        - { seed: "10123", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_1}}"}
        dependencies: [agg-00]
        # when: "{{tasks.agg-00.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-01
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-00.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-00.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-01]
        # when: "{{tasks.agg-00.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 2
      - name: train-02
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-01.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-01.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-01.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-01.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "10201", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_1}}"}
        - { seed: "10202", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_1}}"}
        - { seed: "10203", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_1}}"}
        - { seed: "10204", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_1}}"}
        - { seed: "10205", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_1}}"}
        - { seed: "10206", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_1}}"}
        - { seed: "10207", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_1}}"}
        - { seed: "10208", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_1}}"}
        - { seed: "10209", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_1}}"}
        - { seed: "10210", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_1}}"}
        - { seed: "10211", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_1}}"}
        - { seed: "10212", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_1}}"}
        - { seed: "10213", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_1}}"}
        - { seed: "10214", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_1}}"}
        - { seed: "10215", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_1}}"}
        - { seed: "10216", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_1}}"}
        - { seed: "10217", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_1}}"}
        - { seed: "10218", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_1}}"}
        - { seed: "10219", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_1}}"}
        - { seed: "10220", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_1}}"}
        - { seed: "10221", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_1}}"}
        - { seed: "10222", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_1}}"}
        - { seed: "10223", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_1}}"}
        dependencies: [agg-01]
        # when: "{{tasks.agg-01.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-02
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-01.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-01.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-02]
        # when: "{{tasks.agg-01.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 3
      - name: train-03
        template: train-job
        # when: "{{tasks.agg-02.status}} != 'Skipped' && {{tasks.agg-02.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-02.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-02.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-02.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-02.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "10301", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_1}}"}
        - { seed: "10302", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_1}}"}
        - { seed: "10303", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_1}}"}
        - { seed: "10304", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_1}}"}
        - { seed: "10305", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_1}}"}
        - { seed: "10306", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_1}}"}
        - { seed: "10307", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_1}}"}
        - { seed: "10308", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_1}}"}
        - { seed: "10309", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_1}}"}
        - { seed: "10310", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_1}}"}
        - { seed: "10311", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_1}}"}
        - { seed: "10312", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_1}}"}
        - { seed: "10313", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_1}}"}
        - { seed: "10314", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_1}}"}
        - { seed: "10315", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_1}}"}
        - { seed: "10316", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_1}}"}
        - { seed: "10317", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_1}}"}
        - { seed: "10318", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_1}}"}
        - { seed: "10319", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_1}}"}
        - { seed: "10320", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_1}}"}
        - { seed: "10321", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_1}}"}
        - { seed: "10322", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_1}}"}
        - { seed: "10323", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_1}}"}
        # dependencies: [agg-02]
        dependencies: [agg-02]

      - name: agg-03
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-02.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-02.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-03]
        # when: "{{tasks.agg-02.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 4
      - name: train-04
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-03.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-03.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-03.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-03.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "10401", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_1}}"}
        - { seed: "10402", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_1}}"}
        - { seed: "10403", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_1}}"}
        - { seed: "10404", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_1}}"}
        - { seed: "10405", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_1}}"}
        - { seed: "10406", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_1}}"}
        - { seed: "10407", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_1}}"}
        - { seed: "10408", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_1}}"}
        - { seed: "10409", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_1}}"}
        - { seed: "10410", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_1}}"}
        - { seed: "10411", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_1}}"}
        - { seed: "10412", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_1}}"}
        - { seed: "10413", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_1}}"}
        - { seed: "10414", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_1}}"}
        - { seed: "10415", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_1}}"}
        - { seed: "10416", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_1}}"}
        - { seed: "10417", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_1}}"}
        - { seed: "10418", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_1}}"}
        - { seed: "10419", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_1}}"}
        - { seed: "10420", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_1}}"}
        - { seed: "10421", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_1}}"}
        - { seed: "10422", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_1}}"}
        - { seed: "10423", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_1}}"}
        dependencies: [agg-03]
        # when: "{{tasks.agg-03.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-04
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-03.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-03.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-04]
        # when: "{{tasks.agg-03.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 5
      - name: train-05
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-04.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-04.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-04.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-04.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "10501", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_1}}"}
        - { seed: "10502", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_1}}"}
        - { seed: "10503", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_1}}"}
        - { seed: "10504", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_1}}"}
        - { seed: "10505", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_1}}"}
        - { seed: "10506", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_1}}"}
        - { seed: "10507", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_1}}"}
        - { seed: "10508", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_1}}"}
        - { seed: "10509", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_1}}"}
        - { seed: "10510", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_1}}"}
        - { seed: "10511", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_1}}"}
        - { seed: "10512", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_1}}"}
        - { seed: "10513", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_1}}"}
        - { seed: "10514", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_1}}"}
        - { seed: "10515", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_1}}"}
        - { seed: "10516", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_1}}"}
        - { seed: "10517", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_1}}"}
        - { seed: "10518", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_1}}"}
        - { seed: "10519", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_1}}"}
        - { seed: "10520", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_1}}"}
        - { seed: "10521", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_1}}"}
        - { seed: "10522", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_1}}"}
        - { seed: "10523", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_1}}"}
        dependencies: [agg-04]
        # when: "{{tasks.agg-04.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-05
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-04.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-04.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-05]
        # when: "{{tasks.agg-04.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"
        
      # Round 6
      - name: train-06
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-05.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-05.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-05.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-05.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "10601", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_2}}"}
        - { seed: "10602", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_2}}"}
        - { seed: "10603", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_2}}"}
        - { seed: "10604", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_2}}"}
        - { seed: "10605", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_2}}"}
        - { seed: "10606", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_2}}"}
        - { seed: "10607", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_2}}"}
        - { seed: "10608", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_2}}"}
        - { seed: "10609", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_2}}"}
        - { seed: "10610", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_2}}"}
        - { seed: "10611", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_2}}"}
        - { seed: "10612", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_2}}"}
        - { seed: "10613", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_2}}"}
        - { seed: "10614", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_2}}"}
        - { seed: "10615", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_2}}"}
        - { seed: "10616", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_2}}"}
        - { seed: "10617", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_2}}"}
        - { seed: "10618", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_2}}"}
        - { seed: "10619", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_2}}"}
        - { seed: "10620", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_2}}"}
        - { seed: "10621", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_2}}"}
        - { seed: "10622", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_2}}"}
        - { seed: "10623", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_2}}"}
        dependencies: [agg-05]
        # when: "{{tasks.agg-05.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-06
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-05.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-05.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-06]
        # when: "{{tasks.agg-05.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"
        
      # Round 7
      - name: train-07
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-06.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-06.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-06.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-06.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "10701", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_2}}"}
        - { seed: "10702", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_2}}"}
        - { seed: "10703", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_2}}"}
        - { seed: "10704", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_2}}"}
        - { seed: "10705", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_2}}"}
        - { seed: "10706", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_2}}"}
        - { seed: "10707", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_2}}"}
        - { seed: "10708", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_2}}"}
        - { seed: "10709", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_2}}"}
        - { seed: "10710", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_2}}"}
        - { seed: "10711", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_2}}"}
        - { seed: "10712", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_2}}"}
        - { seed: "10713", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_2}}"}
        - { seed: "10714", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_2}}"}
        - { seed: "10715", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_2}}"}
        - { seed: "10716", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_2}}"}
        - { seed: "10717", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_2}}"}
        - { seed: "10718", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_2}}"}
        - { seed: "10719", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_2}}"}
        - { seed: "10720", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_2}}"}
        - { seed: "10721", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_2}}"}
        - { seed: "10722", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_2}}"}
        - { seed: "10723", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_2}}"}
        dependencies: [agg-06]
        # when: "{{tasks.agg-06.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-07
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-06.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-06.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-07]
        # when: "{{tasks.agg-06.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"
        
      # Round 8
      - name: train-08
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-07.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-07.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-07.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-07.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "10801", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_2}}"}
        - { seed: "10802", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_2}}"}
        - { seed: "10803", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_2}}"}
        - { seed: "10804", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_2}}"}
        - { seed: "10805", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_2}}"}
        - { seed: "10806", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_2}}"}
        - { seed: "10807", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_2}}"}
        - { seed: "10808", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_2}}"}
        - { seed: "10809", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_2}}"}
        - { seed: "10810", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_2}}"}
        - { seed: "10811", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_2}}"}
        - { seed: "10812", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_2}}"}
        - { seed: "10813", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_2}}"}
        - { seed: "10814", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_2}}"}
        - { seed: "10815", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_2}}"}
        - { seed: "10816", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_2}}"}
        - { seed: "10817", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_2}}"}
        - { seed: "10818", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_2}}"}
        - { seed: "10819", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_2}}"}
        - { seed: "10820", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_2}}"}
        - { seed: "10821", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_2}}"}
        - { seed: "10822", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_2}}"}
        - { seed: "10823", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_2}}"}
        dependencies: [agg-07]
        # when: "{{tasks.agg-07.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-08
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-07.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-07.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-08]
        # when: "{{tasks.agg-07.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"
        
      # Round 9
      - name: train-09
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-08.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-08.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-08.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-08.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "10901", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_2}}"}
        - { seed: "10902", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_2}}"}
        - { seed: "10903", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_2}}"}
        - { seed: "10904", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_2}}"}
        - { seed: "10905", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_2}}"}
        - { seed: "10906", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_2}}"}
        - { seed: "10907", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_2}}"}
        - { seed: "10908", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_2}}"}
        - { seed: "10909", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_2}}"}
        - { seed: "10910", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_2}}"}
        - { seed: "10911", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_2}}"}
        - { seed: "10912", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_2}}"}
        - { seed: "10913", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_2}}"}
        - { seed: "10914", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_2}}"}
        - { seed: "10915", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_2}}"}
        - { seed: "10916", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_2}}"}
        - { seed: "10917", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_2}}"}
        - { seed: "10918", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_2}}"}
        - { seed: "10919", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_2}}"}
        - { seed: "10920", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_2}}"}
        - { seed: "10921", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_2}}"}
        - { seed: "10922", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_2}}"}
        - { seed: "10923", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_2}}"}
        dependencies: [agg-08]
        # when: "{{tasks.agg-08.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-09
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-08.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-08.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-09]
        # when: "{{tasks.agg-08.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"
        
      # Round 10
      - name: train-10
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            # value: "10" # 연속 실험 20250127
            value: "{{tasks.agg-09.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            # value: "027" # 연속 실험 20250127
            value: "{{tasks.agg-09.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            # value: "/fedpod/states/select01_0/R{{workflow.parameters.rounds}}r{{tasks.agg-09.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-09.outputs.parameters.next-round}}_agg.pth" # 연속 실험 20250127
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-09.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-09.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "11001", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_2}}"}
        - { seed: "11002", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_2}}"}
        - { seed: "11003", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_2}}"}
        - { seed: "11004", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_2}}"}
        - { seed: "11005", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_2}}"}
        - { seed: "11006", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_2}}"}
        - { seed: "11007", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_2}}"}
        - { seed: "11008", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_2}}"}
        - { seed: "11009", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_2}}"}
        - { seed: "11010", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_2}}"}
        - { seed: "11011", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_2}}"}
        - { seed: "11012", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_2}}"}
        - { seed: "11013", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_2}}"}
        - { seed: "11014", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_2}}"}
        - { seed: "11015", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_2}}"}
        - { seed: "11016", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_2}}"}
        - { seed: "11017", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_2}}"}
        - { seed: "11018", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_2}}"}
        - { seed: "11019", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_2}}"}
        - { seed: "11020", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_2}}"}
        - { seed: "11021", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_2}}"}
        - { seed: "11022", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_2}}"}
        - { seed: "11023", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_2}}"}
        dependencies: [agg-09]
        # when: "{{tasks.agg-09.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-10
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            # value: "10" # 연속 실험 20250127
            value: "{{tasks.agg-09.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            # value: "027" # 연속 실험 20250127
            value: "{{tasks.agg-09.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-10]
        # when: "{{tasks.agg-09.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"
        
      # Round 11
      - name: train-11
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-10.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-10.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-10.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-10.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "11101", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_2}}"}
        - { seed: "11102", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_2}}"}
        - { seed: "11103", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_2}}"}
        - { seed: "11104", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_2}}"}
        - { seed: "11105", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_2}}"}
        - { seed: "11106", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_2}}"}
        - { seed: "11107", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_2}}"}
        - { seed: "11108", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_2}}"}
        - { seed: "11109", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_2}}"}
        - { seed: "11110", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_2}}"}
        - { seed: "11111", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_2}}"}
        - { seed: "11112", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_2}}"}
        - { seed: "11113", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_2}}"}
        - { seed: "11114", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_2}}"}
        - { seed: "11115", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_2}}"}
        - { seed: "11116", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_2}}"}
        - { seed: "11117", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_2}}"}
        - { seed: "11118", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_2}}"}
        - { seed: "11119", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_2}}"}
        - { seed: "11120", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_2}}"}
        - { seed: "11121", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_2}}"}
        - { seed: "11122", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_2}}"}
        - { seed: "11123", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_2}}"}
        dependencies: [agg-10]
        # when: "{{tasks.agg-10.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-11
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-10.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-10.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-11]
        # when: "{{tasks.agg-10.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 12
      - name: train-12
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-11.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-11.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-11.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-11.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "11201", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_2}}"}
        - { seed: "11202", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_2}}"}
        - { seed: "11203", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_2}}"}
        - { seed: "11204", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_2}}"}
        - { seed: "11205", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_2}}"}
        - { seed: "11206", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_2}}"}
        - { seed: "11207", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_2}}"}
        - { seed: "11208", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_2}}"}
        - { seed: "11209", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_2}}"}
        - { seed: "11210", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_2}}"}
        - { seed: "11211", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_2}}"}
        - { seed: "11212", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_2}}"}
        - { seed: "11213", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_2}}"}
        - { seed: "11214", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_2}}"}
        - { seed: "11215", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_2}}"}
        - { seed: "11216", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_2}}"}
        - { seed: "11217", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_2}}"}
        - { seed: "11218", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_2}}"}
        - { seed: "11219", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_2}}"}
        - { seed: "11220", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_2}}"}
        - { seed: "11221", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_2}}"}
        - { seed: "11222", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_2}}"}
        - { seed: "11223", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_2}}"}
        dependencies: [agg-11]
        # when: "{{tasks.agg-11.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-12
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-11.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-11.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-12]
        # when: "{{tasks.agg-11.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 13
      - name: train-13
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-12.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-12.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-12.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-12.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "11301", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_2}}"}
        - { seed: "11302", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_2}}"}
        - { seed: "11303", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_2}}"}
        - { seed: "11304", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_2}}"}
        - { seed: "11305", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_2}}"}
        - { seed: "11306", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_2}}"}
        - { seed: "11307", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_2}}"}
        - { seed: "11308", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_2}}"}
        - { seed: "11309", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_2}}"}
        - { seed: "11310", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_2}}"}
        - { seed: "11311", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_2}}"}
        - { seed: "11312", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_2}}"}
        - { seed: "11313", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_2}}"}
        - { seed: "11314", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_2}}"}
        - { seed: "11315", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_2}}"}
        - { seed: "11316", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_2}}"}
        - { seed: "11317", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_2}}"}
        - { seed: "11318", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_2}}"}
        - { seed: "11319", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_2}}"}
        - { seed: "11320", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_2}}"}
        - { seed: "11321", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_2}}"}
        - { seed: "11322", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_2}}"}
        - { seed: "11323", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_2}}"}
        dependencies: [agg-12]
        # when: "{{tasks.agg-12.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-13
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-12.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-12.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-13]
        # when: "{{tasks.agg-12.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 14
      - name: train-14
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-13.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-13.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-13.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-13.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "11401", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_2}}"}
        - { seed: "11402", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_2}}"}
        - { seed: "11403", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_2}}"}
        - { seed: "11404", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_2}}"}
        - { seed: "11405", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_2}}"}
        - { seed: "11406", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_2}}"}
        - { seed: "11407", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_2}}"}
        - { seed: "11408", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_2}}"}
        - { seed: "11409", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_2}}"}
        - { seed: "11410", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_2}}"}
        - { seed: "11411", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_2}}"}
        - { seed: "11412", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_2}}"}
        - { seed: "11413", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_2}}"}
        - { seed: "11414", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_2}}"}
        - { seed: "11415", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_2}}"}
        - { seed: "11416", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_2}}"}
        - { seed: "11417", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_2}}"}
        - { seed: "11418", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_2}}"}
        - { seed: "11419", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_2}}"}
        - { seed: "11420", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_2}}"}
        - { seed: "11421", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_2}}"}
        - { seed: "11422", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_2}}"}
        - { seed: "11423", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_2}}"}
        dependencies: [agg-13]
        # when: "{{tasks.agg-13.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-14
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-13.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-13.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-14]
        # when: "{{tasks.agg-13.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 15
      - name: train-15
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-14.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-14.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-14.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-14.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "11501", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_3}}"}
        - { seed: "11502", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_3}}"}
        - { seed: "11503", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_3}}"}
        - { seed: "11504", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_3}}"}
        - { seed: "11505", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_3}}"}
        - { seed: "11506", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_3}}"}
        - { seed: "11507", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_3}}"}
        - { seed: "11508", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_3}}"}
        - { seed: "11509", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_3}}"}
        - { seed: "11510", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_3}}"}
        - { seed: "11511", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_3}}"}
        - { seed: "11512", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_3}}"}
        - { seed: "11513", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_3}}"}
        - { seed: "11514", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_3}}"}
        - { seed: "11515", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_3}}"}
        - { seed: "11516", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_3}}"}
        - { seed: "11517", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_3}}"}
        - { seed: "11518", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_3}}"}
        - { seed: "11519", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_3}}"}
        - { seed: "11520", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_3}}"}
        - { seed: "11521", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_3}}"}
        - { seed: "11522", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_3}}"}
        - { seed: "11523", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_3}}"}

        dependencies: [agg-14]
        # when: "{{tasks.agg-14.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-15
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-14.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-14.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-15]
        # when: "{{tasks.agg-14.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 16
      - name: train-16
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-15.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-15.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-15.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-15.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "11601", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_3}}"}
        - { seed: "11602", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_3}}"}
        - { seed: "11603", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_3}}"}
        - { seed: "11604", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_3}}"}
        - { seed: "11605", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_3}}"}
        - { seed: "11606", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_3}}"}
        - { seed: "11607", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_3}}"}
        - { seed: "11608", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_3}}"}
        - { seed: "11609", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_3}}"}
        - { seed: "11610", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_3}}"}
        - { seed: "11611", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_3}}"}
        - { seed: "11612", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_3}}"}
        - { seed: "11613", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_3}}"}
        - { seed: "11614", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_3}}"}
        - { seed: "11615", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_3}}"}
        - { seed: "11616", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_3}}"}
        - { seed: "11617", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_3}}"}
        - { seed: "11618", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_3}}"}
        - { seed: "11619", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_3}}"}
        - { seed: "11620", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_3}}"}
        - { seed: "11621", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_3}}"}
        - { seed: "11622", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_3}}"}
        - { seed: "11623", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_3}}"}
        dependencies: [agg-15]
        # when: "{{tasks.agg-15.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-16
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-15.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-15.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-16]
        # when: "{{tasks.agg-15.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 17
      - name: train-17
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-16.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-16.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-16.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-16.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "11701", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_3}}"}
        - { seed: "11702", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_3}}"}
        - { seed: "11703", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_3}}"}
        - { seed: "11704", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_3}}"}
        - { seed: "11705", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_3}}"}
        - { seed: "11706", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_3}}"}
        - { seed: "11707", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_3}}"}
        - { seed: "11708", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_3}}"}
        - { seed: "11709", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_3}}"}
        - { seed: "11710", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_3}}"}
        - { seed: "11711", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_3}}"}
        - { seed: "11712", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_3}}"}
        - { seed: "11713", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_3}}"}
        - { seed: "11714", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_3}}"}
        - { seed: "11715", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_3}}"}
        - { seed: "11716", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_3}}"}
        - { seed: "11717", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_3}}"}
        - { seed: "11718", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_3}}"}
        - { seed: "11719", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_3}}"}
        - { seed: "11720", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_3}}"}
        - { seed: "11721", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_3}}"}
        - { seed: "11722", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_3}}"}
        - { seed: "11723", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_3}}"}
        dependencies: [agg-16]
        # when: "{{tasks.agg-16.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-17
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-16.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-16.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-17]
        # when: "{{tasks.agg-16.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 18
      - name: train-18
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-17.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-17.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-17.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-17.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "11801", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_3}}"}
        - { seed: "11802", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_3}}"}
        - { seed: "11803", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_3}}"}
        - { seed: "11804", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_3}}"}
        - { seed: "11805", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_3}}"}
        - { seed: "11806", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_3}}"}
        - { seed: "11807", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_3}}"}
        - { seed: "11808", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_3}}"}
        - { seed: "11809", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_3}}"}
        - { seed: "11810", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_3}}"}
        - { seed: "11811", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_3}}"}
        - { seed: "11812", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_3}}"}
        - { seed: "11813", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_3}}"}
        - { seed: "11814", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_3}}"}
        - { seed: "11815", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_3}}"}
        - { seed: "11816", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_3}}"}
        - { seed: "11817", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_3}}"}
        - { seed: "11818", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_3}}"}
        - { seed: "11819", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_3}}"}
        - { seed: "11820", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_3}}"}
        - { seed: "11821", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_3}}"}
        - { seed: "11822", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_3}}"}
        - { seed: "11823", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_3}}"}
        dependencies: [agg-17]
        # when: "{{tasks.agg-17.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-18
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-17.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-17.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-18]
        # when: "{{tasks.agg-17.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      # Round 19
      - name: train-19
        template: train-job
        arguments:
          parameters:
          - name: seed
            value: "{{item.seed}}"
          - name: train-script
            value: "{{workflow.parameters.train-script}}"
          - name: round
            value: "{{tasks.agg-18.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-18.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: model_pth
            value: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R{{workflow.parameters.rounds}}r{{tasks.agg-18.outputs.parameters.next-round}}/models/R{{workflow.parameters.rounds}}r{{tasks.agg-18.outputs.parameters.next-round}}_agg.pth"
          - name: data_percentage
            value: "{{item.data_percentage}}"
        withItems:
        - { seed: "11901", inst:  "1", data_percentage: "{{workflow.parameters.inst_01_ratio_3}}"}
        - { seed: "11902", inst:  "2", data_percentage: "{{workflow.parameters.inst_02_ratio_3}}"}
        - { seed: "11903", inst:  "3", data_percentage: "{{workflow.parameters.inst_03_ratio_3}}"}
        - { seed: "11904", inst:  "4", data_percentage: "{{workflow.parameters.inst_04_ratio_3}}"}
        - { seed: "11905", inst:  "5", data_percentage: "{{workflow.parameters.inst_05_ratio_3}}"}
        - { seed: "11906", inst:  "6", data_percentage: "{{workflow.parameters.inst_06_ratio_3}}"}
        - { seed: "11907", inst:  "7", data_percentage: "{{workflow.parameters.inst_07_ratio_3}}"}
        - { seed: "11908", inst:  "8", data_percentage: "{{workflow.parameters.inst_08_ratio_3}}"}
        - { seed: "11909", inst:  "9", data_percentage: "{{workflow.parameters.inst_09_ratio_3}}"}
        - { seed: "11910", inst: "10", data_percentage: "{{workflow.parameters.inst_10_ratio_3}}"}
        - { seed: "11911", inst: "11", data_percentage: "{{workflow.parameters.inst_11_ratio_3}}"}
        - { seed: "11912", inst: "12", data_percentage: "{{workflow.parameters.inst_12_ratio_3}}"}
        - { seed: "11913", inst: "13", data_percentage: "{{workflow.parameters.inst_13_ratio_3}}"}
        - { seed: "11914", inst: "14", data_percentage: "{{workflow.parameters.inst_14_ratio_3}}"}
        - { seed: "11915", inst: "15", data_percentage: "{{workflow.parameters.inst_15_ratio_3}}"}
        - { seed: "11916", inst: "16", data_percentage: "{{workflow.parameters.inst_16_ratio_3}}"}
        - { seed: "11917", inst: "17", data_percentage: "{{workflow.parameters.inst_17_ratio_3}}"}
        - { seed: "11918", inst: "18", data_percentage: "{{workflow.parameters.inst_18_ratio_3}}"}
        - { seed: "11919", inst: "19", data_percentage: "{{workflow.parameters.inst_19_ratio_3}}"}
        - { seed: "11920", inst: "20", data_percentage: "{{workflow.parameters.inst_20_ratio_3}}"}
        - { seed: "11921", inst: "21", data_percentage: "{{workflow.parameters.inst_21_ratio_3}}"}
        - { seed: "11922", inst: "22", data_percentage: "{{workflow.parameters.inst_22_ratio_3}}"}
        - { seed: "11923", inst: "23", data_percentage: "{{workflow.parameters.inst_23_ratio_3}}"}
        dependencies: [agg-18]
        # when: "{{tasks.agg-18.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

      - name: agg-19
        template: aggregation-job
        arguments:
          parameters:
          - name: agg-script
            value: "{{workflow.parameters.agg-script}}"
          - name: round
            value: "{{tasks.agg-18.outputs.parameters.next-round}}"
          - name: epochs
            value: "003"
          - name: epoch
            value: "{{tasks.agg-18.outputs.parameters.next-epoch}}"
          - name: inst-id
            value: "0"
          - name: model_pth
            value: "None"
          - name: algorithm
            value: "{{workflow.parameters.agg-algo}}"
        dependencies: [train-19]
        # when: "{{tasks.agg-18.outputs.parameters.next-round}} < {{workflow.parameters.rounds}}"

  # Round 20 (Inference)
  - name: infer-dag
    dag:
      tasks:
      - name: infer-20
        template: infer-job
        arguments:
          parameters:
          - name: infer-script
            value: "{{workflow.parameters.infer-script}}"
          - name: job-name
            value: "{{item.job-name}}"
          - name: rounds
            value: "{{item.rounds}}"
          - name: round
            value: "{{item.round}}"
          - name: epoch
            value: "{{item.epoch}}"
          - name: inst-id
            value: "{{item.inst}}"
          - name: split_csv
            value: "{{item.split_csv}}"
          - name: model_pth
            value: "{{item.model_pth}}"
          - name: data_root
            value: "{{workflow.parameters.data_root}}"
          - name: data_set
            value: "{{workflow.parameters.data_set}}"
          - name: inst_root
            value: "inst_00"
          - name: input_channels
            value: "{{workflow.parameters.input_channel_names}}"
        withItems:
        - { job-name: "{{workflow.parameters.job-prefix}}_test", 
            rounds: "{{workflow.parameters.rounds}}", 
            round: "20", 
            epoch: "000", 
            inst: "0", 
            split_csv: "{{workflow.parameters.split_csv}}", 
            model_pth: "/fedpod/states/{{workflow.parameters.job-prefix}}_0/R20r20/models/R20r20_agg.pth"}

  - name: train-job
    inputs:
      parameters:
      - name: seed
      - name: train-script
      - name: round
      - name: epochs
      - name: epoch
      - name: inst-id
      - name: model_pth
      - name: data_percentage
    container:
      image: dwnusa/fedpod:v0.4.18.03
      imagePullPolicy: Always
      command: ["/bin/sh", "-c"]
      args:
        - >
          ./{{inputs.parameters.train-script}} 
          -S {{inputs.parameters.seed}} 
          -s 0
          -f 10
          -m 15
          -g 0 
          -J {{workflow.parameters.job-prefix}}_{{inputs.parameters.inst-id}} 
          -R {{workflow.parameters.rounds}} 
          -r {{inputs.parameters.round}} 
          -E {{inputs.parameters.epochs}} 
          -e {{inputs.parameters.epoch}} 
          -i {{inputs.parameters.inst-id}} 
          -c {{workflow.parameters.split_csv}} 
          -M {{inputs.parameters.model_pth}}
          -p {{inputs.parameters.data_percentage}}
          -D {{workflow.parameters.data_root}} 
          -d {{workflow.parameters.data_set}}
      resources:
        requests:
          cpu: "2"
          memory: "8G"
      volumeMounts:
      - name: csv-volume
        mountPath: /fedpod/experiments
      - name: cc359ppmi128-volume
        mountPath: /fedpod/data
      - name: states-volume
        mountPath: /fedpod/states
      - name: logs-volume
        mountPath: /fedpod/logs
      - name: runs-volume
        mountPath: /fedpod/runs
      stdin: true
      tty: true
    volumes:
    - name: csv-volume
      hostPath:
        path: /fedpod/experiments  # 로컬 경로
        type: Directory
    - name: cc359ppmi128-volume
      hostPath:
        path: /fedpod/{{workflow.parameters.data_root}}  # 로컬 경로
        type: Directory
    - name: states-volume
      hostPath:
        path: /fedpod/states  # 로컬 경로
        type: Directory
    - name: logs-volume
      hostPath:
        path: /fedpod/logs  # 로컬 경로
        type: Directory
    - name: runs-volume
      hostPath:
        path: /fedpod/runs  # 로컬 경로
        type: Directory


  - name: aggregation-job
    inputs:
      parameters:
      - name: agg-script
      - name: round
      - name: epochs
      - name: epoch
      - name: algorithm
      - name: inst-id
      - name: model_pth
    container:
      image: dwnusa/fedpod:v0.4.18.03
      imagePullPolicy: Always
      command: ["/bin/sh", "-c"]
      args: 
        - >
          ./{{inputs.parameters.agg-script}} 
          -R {{workflow.parameters.rounds}} 
          -r {{inputs.parameters.round}} 
          -E {{inputs.parameters.epochs}} 
          -e {{inputs.parameters.epoch}} 
          -j {{workflow.parameters.job-prefix}} 
          -i {{inputs.parameters.inst-id}} 
          -a {{inputs.parameters.algorithm}} 
          -M {{inputs.parameters.model_pth}}
      resources:
        requests:
          cpu: "2"
          memory: "4G"
      volumeMounts:
      - name: csv-volume
        mountPath: /fedpod/experiments
      - name: cc359ppmi128-volume
        mountPath: /fedpod/data
      - name: states-volume
        mountPath: /fedpod/states
      - name: logs-volume
        mountPath: /fedpod/logs
      - name: runs-volume
        mountPath: /fedpod/runs
      stdin: true
      tty: true
    outputs:
      parameters:
      - name: next-round
        valueFrom:
          path: /tmp/next_round.txt  # Return the value from the temp file
          default: "{{workflow.parameters.rounds}}"
      - name: next-epoch
        valueFrom:
          path: /tmp/next_epoch.txt
          default: "0"
    volumes:
    - name: csv-volume
      hostPath:
        path: /fedpod/experiments  # 로컬 경로
        type: Directory
    - name: cc359ppmi128-volume
      hostPath:
        path: /fedpod/{{workflow.parameters.data_root}}  # 로컬 경로
        type: Directory
    - name: states-volume
      hostPath:
        path: /fedpod/states  # 로컬 경로
        type: Directory
    - name: logs-volume
      hostPath:
        path: /fedpod/logs  # 로컬 경로
        type: Directory
    - name: runs-volume
      hostPath:
        path: /fedpod/runs  # 로컬 경로
        type: Directory

        
  - name: infer-job
    inputs:
      parameters:
      - name: infer-script
      - name: job-name
      - name: rounds
      - name: round
      - name: epoch
      - name: inst-id
      - name: split_csv
      - name: model_pth
      - name: data_root
      - name: data_set
      - name: inst_root
      - name: input_channels
    container:
      image: dwnusa/fedpod:v0.4.18.03
      imagePullPolicy: Always
      command: ["/bin/sh", "-c"]
      args: 
        - >
          ./{{inputs.parameters.infer-script}}
          -s 1
          -g 0
          -J {{inputs.parameters.job-name}}
          -i {{inputs.parameters.inst-id}}
          -R {{inputs.parameters.rounds}}
          -r {{inputs.parameters.round}}
          -e {{inputs.parameters.epoch}}
          -c {{inputs.parameters.split_csv}}
          -M {{inputs.parameters.model_pth}}
          -t test
          -D {{inputs.parameters.data_root}}
          -d {{inputs.parameters.data_set}}
          -n {{inputs.parameters.inst_root}}
          -C {{inputs.parameters.input_channels}}
      resources:
        requests:
          cpu: "2"
          memory: "8G"
      volumeMounts:
      - name: csv-volume
        mountPath: /fedpod/experiments
      - name: cc359ppmi128-volume
        mountPath: /fedpod/data
      - name: states-volume
        mountPath: /fedpod/states
      - name: logs-volume
        mountPath: /fedpod/logs
      - name: runs-volume
        mountPath: /fedpod/runs
      stdin: true
      tty: true
    volumes:
    - name: csv-volume
      hostPath:
        path: /fedpod/experiments  # 로컬 경로
        type: Directory
    - name: cc359ppmi128-volume
      hostPath:
        path: /fedpod/{{inputs.parameters.data_root}}  # 로컬 경로
        type: Directory
    - name: states-volume
      hostPath:
        path: /fedpod/states  # 로컬 경로
        type: Directory
    - name: logs-volume
      hostPath:
        path: /fedpod/logs  # 로컬 경로
        type: Directory
    - name: runs-volume
      hostPath:
        path: /fedpod/runs  # 로컬 경로
        type: Directory

  - name: dummy-task
    container:
      image: alpine:3.7
      command: [sh, -c]
      args: ["echo '12' > /tmp/next_round.txt; echo '0' > /tmp/next_epoch.txt"]
    outputs:
      parameters:
      - name: next-round
        valueFrom:
          path: /tmp/next_round.txt
      - name: next-epoch
        valueFrom:
          path: /tmp/next_epoch.txt